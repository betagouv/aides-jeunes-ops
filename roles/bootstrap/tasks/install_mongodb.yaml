- name: Install mongoDB 6.x
  block:
    - name: "add mongoDB 6.x apt key"
      apt_key:
        url: https://www.mongodb.org/static/pgp/server-6.0.asc
        state: present
    - name: "use the correct package source depending on architecture"
      shell:
        cmd: arch
      register: server_arch
    - name: "add mongoDB 6.x ppa for apt repo - arm64"
      ansible.builtin.apt_repository:
        repo: deb https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/6.0 multiverse
        update_cache: true
      when: "server_arch.stdout == 'aarch64'"
    - name: "add mongoDB 6.x ppa for apt repo - amd64"
      ansible.builtin.apt_repository:
        repo: deb https://repo.mongodb.org/apt/debian bullseye/mongodb-org/6.0 main
        update_cache: true
      when: "server_arch.stdout != 'aarch64'"
    - name: "install mongoDB"
      apt:
        update_cache: true
        name: mongodb-org
      notify: "reload systemd"
      changed_when: true
    - name: "start mongod service if not started"
      become: true
      become_method: sudo
      ansible.builtin.service:
        name: mongod
        state: started
    - name: "enable mongod service"
      become: true
      become_method: sudo
      ansible.builtin.systemd:
        name: mongod
        enabled: true
        daemon_reload: yes
